<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <script>
    const weak = new WeakMap();
    function deepClone(val) {
      if (typeof val !== 'object') {
        return val
      }
      if (Array.isArray(val)) {
        return val.map(item => deepClone(item))
      }
      if (weak.has(val)) {
        console.log(weak.get(val),'val')
        return weak.get(val)
      }

      if (typeof val === 'object') {
        let obj = {}
        weak.set(val, obj);
        for (let key in val) {
          obj[key] = deepClone(val[key]);
        }
        return obj
      }
    }

    let obj = {
      a: 1,
      b: 2,
      c: {
        d: 1    // 每次地址相同
      }
    }
    obj.c.d = obj.c  // 导致 d 每次地址相同
    let obj2 = deepClone(obj)  
    obj2.c.d.d.d.d.d = 666   //  obj2.c.d = 666
    obj.c.d.d.d.d.d = 666 
    console.log(obj2, 'obj2', obj); // lhy-log
  </script>
</body>

</html>